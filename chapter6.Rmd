# Analysis of Longitudinal Data
## Tasks

*Analysis.*

- Describe your work and results clearly. 
- Assume the reader has an introductory course level understanding of writing and reading R code as well as statistical methods.
- Assume the reader has no previous knowledge of your data or the more advanced methods you are using.

*Preamble*
```{r}
# load packages
library(dplyr)
library(ggplot2)
library(GGally)
library(tidyr)
library(openxlsx)
library(corrplot)
library(knitr)
```

## Q1: Loading Dataset & graphical overview
```{r}
BPRSL <- read.table(file="~/R/win-library/4.0/IODS-project/data/BPRSL.txt", sep  =" ", header = T)

RATSL <- read.table(file="~/R/win-library/4.0/IODS-project/data/RATSL.txt", header = TRUE, sep = '\t')

dim(BPRSL)
dim(RATSL)

#For graphs & analysis, SWAP CH8 data for CH9 and vice versa.

# Factor ID & Group
RATSL$ID <- factor(RATSL$ID)
RATSL$Group <- factor(RATSL$Group)

# Take a glimpse at the RATSL data
glimpse(RATSL)
```

## Figure 8.1 with RATSL
```{r}
p1 <- ggplot(RATSL, aes(x = Time, y = Weight, linetype = ID))
p2 <- p1 + geom_line() + scale_linetype_manual(values = rep(1:10, times=4))
p3 <- p2 + facet_grid(. ~ Group, labeller = label_both)
p4 <- p3 + theme_bw() + theme(legend.position = "none")
p5 <- p4 + theme(panel.grid.minor.y = element_blank())
p6 <- p5 + scale_y_continuous(limits = c(min(RATSL$Weight), max(RATSL$Weight)))
p6
```

We observe the Rat groups and their various weights. For Group 1, weights are below 300 grams whiles Group 2 has the highest weights up to 700 grams. Group 2 comes mid-way with weights averaging 500 grams.

## Figure 9.1 with BPRSL
```{r, echo=TRUE}
p1 <- ggplot(BPRSL, aes(x = week, y = bprs, group = subject))
p2 <- p1 + geom_text(aes(label = treatment))
p3 <- p2 + scale_x_continuous(name = "Time (weeks)", breaks = seq(0, 8, 1))
p4 <- p3 + scale_y_continuous(name = "bprs (score)")
p5 <- p4 + theme_bw()
p6 <- p5 + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
p6
```

We observe the BPRS scale and notice that  the BPRS score of almost all the men is decreasing over the eight weeks of the study. This is a general trend with the treatment group.

## Figure 8.2 with RATSL

```{r}
# Standardize the weights:
RATSL <- RATSL %>%
  group_by(Time) %>%
  mutate( stdweight = (Weight - mean(Weight))/sd(Weight) ) %>%
  ungroup()
glimpse(RATSL)
p1 <- ggplot(RATSL, aes(x = Time, y = stdweight, linetype = ID))
p2 <- p1 + geom_line() + scale_linetype_manual(values = rep(1:10, times=4))
p3 <- p2 + facet_grid(. ~ Group, labeller = label_both)
p4 <- p3 + theme_bw() + theme(legend.position = "none")
p5 <- p4 + theme(panel.grid.minor.y = element_blank())
p6 <- p5 + scale_y_continuous(name = "standardized Weight")
p6
```

Standardizing the weights normalizes the variables. However, the magnitudes observed above do not change with Group 2 recording the highest followed by Group 3 then Group 1.

## Figure 8.3 with RATSL

```{r}
# Number of Times, baseline :
n <- RATSL$Time %>% unique() %>% length()
# Make a summary data:
RATSS <- RATSL %>%
  group_by(Group, Time) %>%
  summarise( mean=mean(Weight), se=sd(Weight)/sqrt(n) ) %>%
  ungroup()
glimpse(RATSS)

p1 <- ggplot(RATSS, aes(x = Time, y = mean, linetype = Group, shape = Group))
p2 <- p1 + geom_line() + scale_linetype_manual(values = c(1,2,3))
p3 <- p2 + geom_point(size=3) + scale_shape_manual(values = c(1,2,3))
p4 <- p3 + geom_errorbar(aes(ymin=mean-se, ymax=mean+se, linetype="1"), width=0.3)
p5 <- p4 + theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
p6 <- p5 + theme(legend.position = c(0.8,0.5))
p7 <- p6 + scale_y_continuous(name = "mean(weight) +/- se(weight)")
p7
```


```{r}
# Create a summary data by Group and ID with mean as the summary variable (ignoring baseline time period 1).
RATSL8S <- RATSL %>%
  filter(Time > 1) %>%
  group_by(Group, ID) %>%
  summarise( mean=mean(Weight) ) %>%
  ungroup()

# Glimpse the data
glimpse(RATSL8S)

# Draw a boxplot of the mean versus treatment
ggplot(RATSL8S, aes(x = Group, y = mean)) +
  geom_boxplot() +
  stat_summary(fun = "mean", geom = "point", shape=23, size=4, fill = "white") +
  scale_y_continuous(name = "mean(Weight), time periods 2-64")
```

```{r}
# Create a new data by filtering the outlier and adjust the ggplot code the draw the plot again with the new data
RATSL8S1 <- RATSL8S %>%
  filter(mean < 550)

# Glimpse the data
glimpse(RATSL8S1)

# Draw a boxplot of the mean versus treatment
ggplot(RATSL8S1, aes(x = Group, y = mean)) +
  geom_boxplot() +
  stat_summary(fun = "mean", geom = "point", shape=23, size=4, fill = "white") +
  scale_y_continuous(name = "mean(Weight), time periods 2-64")
```
